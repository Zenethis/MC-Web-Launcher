var at=Object.defineProperty;var it=(o,e,t)=>e in o?at(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var u=(o,e,t)=>it(o,typeof e!="symbol"?e+"":e,t);import{S as st}from"./style-Bb8o_QaJ.js";import ct from"https://unpkg.com/stats.js@0.17.0/src/Stats.js";class v{constructor(){u(this,"speed",1);u(this,"paused",!1);u(this,"progress",0);u(this,"currentId",0);u(this,"progress0",new Map);u(this,"animationObjects",new Map)}update(e,t){if(this.paused)return;const n=t*this.speed;this.animate(e,n),this.animationObjects.forEach((s,d)=>{const r=this.progress0.get(d);s(e,this.progress-r,d)}),this.progress+=n}addAnimation(e){const t=this.currentId++;return this.progress0.set(t,this.progress),this.animationObjects.set(t,e),t}removeAnimation(e){e!=null&&(this.animationObjects.delete(e),this.progress0.delete(e))}}class rt extends v{animate(e){const t=this.progress*2,n=Math.PI*.02;e.skin.leftArm.rotation.z=Math.cos(t)*.03+n,e.skin.rightArm.rotation.z=Math.cos(t+Math.PI)*.03-n;const s=Math.PI*.06;e.cape.rotation.x=Math.sin(t)*.01+s}}class dt extends v{constructor(){super(...arguments);u(this,"headBobbing",!0)}animate(t){const n=this.progress*8;t.skin.leftLeg.rotation.x=Math.sin(n)*.5,t.skin.rightLeg.rotation.x=Math.sin(n+Math.PI)*.5,t.skin.leftArm.rotation.x=Math.sin(n+Math.PI)*.5,t.skin.rightArm.rotation.x=Math.sin(n)*.5;const s=Math.PI*.02;t.skin.leftArm.rotation.z=Math.cos(n)*.03+s,t.skin.rightArm.rotation.z=Math.cos(n+Math.PI)*.03-s,this.headBobbing?(t.skin.head.rotation.y=Math.sin(n/4)*.2,t.skin.head.rotation.x=Math.sin(n/5)*.1):(t.skin.head.rotation.y=0,t.skin.head.rotation.x=0);const d=Math.PI*.06;t.cape.rotation.x=Math.sin(n/1.5)*.06+d}}class mt extends v{animate(e){const t=this.progress*15+Math.PI*.5;e.skin.leftLeg.rotation.x=Math.cos(t+Math.PI)*1.3,e.skin.rightLeg.rotation.x=Math.cos(t)*1.3,e.skin.leftArm.rotation.x=Math.cos(t)*1.5,e.skin.rightArm.rotation.x=Math.cos(t+Math.PI)*1.5;const n=Math.PI*.1;e.skin.leftArm.rotation.z=Math.cos(t)*.1+n,e.skin.rightArm.rotation.z=Math.cos(t+Math.PI)*.1-n,e.position.y=Math.cos(t*2),e.position.x=Math.cos(t)*.15,e.rotation.z=Math.cos(t+Math.PI)*.01;const s=Math.PI*.3;e.cape.rotation.x=Math.sin(t*2)*.1+s}}function F(o,e,t){return o<=e?e:o>=t?t:o}class ht extends v{animate(e){const t=this.progress>0?this.progress*20:0,n=F(t*t/100,0,1);e.rotation.x=n*Math.PI/2,e.skin.head.rotation.x=n>.5?Math.PI/4-e.rotation.x:0;const s=Math.PI*.25*n;e.skin.leftArm.rotation.z=s,e.skin.rightArm.rotation.z=-s;const d=.34906584,r=Math.PI/2,h=Math.pow(.9,t);e.elytra.leftWing.rotation.x=d+h*(.2617994-d),e.elytra.leftWing.rotation.z=r+h*(.2617994-r),e.elytra.updateRightWing()}}class lt extends v{constructor(t="left"){super();u(this,"whichArm");this.whichArm=t}animate(t){const n=this.progress*2*Math.PI*.5,s=this.whichArm==="left"?t.skin.leftArm:t.skin.rightArm;s.rotation.x=180,s.rotation.z=Math.sin(n)*.5}}class D extends v{constructor(){super(...arguments);u(this,"showProgress",!1);u(this,"runOnce",!1);u(this,"isRunningHitAnimation",!1);u(this,"hitAnimationSpeed",1);u(this,"erp",0);u(this,"isCrouched")}addHitAnimation(t=this.speed){this.isRunningHitAnimation=!0,this.hitAnimationSpeed=t}animate(t){let n=this.progress*8;n===0&&(this.isCrouched=void 0),this.runOnce&&(n=F(n,-1,1)),this.showProgress||(n=Math.floor(n)),t.skin.body.rotation.x=.4537860552*Math.abs(Math.sin(n*Math.PI/2)),t.skin.body.position.z=1.3256181*Math.abs(Math.sin(n*Math.PI/2))-3.4500310377*Math.abs(Math.sin(n*Math.PI/2)),t.skin.body.position.y=-6-2.103677462*Math.abs(Math.sin(n*Math.PI/2)),t.cape.position.y=8-1.851236166577372*Math.abs(Math.sin(n*Math.PI/2)),t.cape.rotation.x=10.8*Math.PI/180+.294220265771*Math.abs(Math.sin(n*Math.PI/2)),t.cape.position.z=-2+3.786619432*Math.abs(Math.sin(n*Math.PI/2))-3.4500310377*Math.abs(Math.sin(n*Math.PI/2)),t.elytra.position.x=t.cape.position.x,t.elytra.position.y=t.cape.position.y,t.elytra.position.z=t.cape.position.z,t.elytra.rotation.x=t.cape.rotation.x-10.8*Math.PI/180;const s=this.progress/this.speed;if(Math.abs(Math.sin(n*Math.PI/2))===1?(this.erp=this.isCrouched?this.erp:s,this.isCrouched=!0,t.elytra.leftWing.rotation.z=.26179944+.4582006*Math.abs(Math.sin(Math.min(s-this.erp,1)*Math.PI/2)),t.elytra.updateRightWing()):this.isCrouched!==void 0&&(this.erp=this.isCrouched?s:this.erp,t.elytra.leftWing.rotation.z=.72-.4582006*Math.abs(Math.sin(Math.min(s-this.erp,1)*Math.PI/2)),t.elytra.updateRightWing(),this.isCrouched=!1),t.skin.head.position.y=-3.618325234674*Math.abs(Math.sin(n*Math.PI/2)),t.skin.leftArm.position.z=3.618325234674*Math.abs(Math.sin(n*Math.PI/2))-3.4500310377*Math.abs(Math.sin(n*Math.PI/2)),t.skin.rightArm.position.z=t.skin.leftArm.position.z,t.skin.leftArm.rotation.x=.410367746202*Math.abs(Math.sin(n*Math.PI/2)),t.skin.rightArm.rotation.x=t.skin.leftArm.rotation.x,t.skin.leftArm.rotation.z=.1,t.skin.rightArm.rotation.z=-t.skin.leftArm.rotation.z,t.skin.leftArm.position.y=-2-2.53943318*Math.abs(Math.sin(n*Math.PI/2)),t.skin.rightArm.position.y=t.skin.leftArm.position.y,t.skin.rightLeg.position.z=-3.4500310377*Math.abs(Math.sin(n*Math.PI/2)),t.skin.leftLeg.position.z=t.skin.rightLeg.position.z,this.isRunningHitAnimation){const d=this.progress;let r=this.progress*18*this.hitAnimationSpeed/this.speed;this.speed==0&&(r=0);const h=Math.abs(Math.sin(d*Math.PI/2))===1;t.skin.rightArm.rotation.x=-.4537860552+2*Math.sin(r+Math.PI)*.3-(h?.4537860552:0);const g=.01*Math.PI+.06;t.skin.rightArm.rotation.z=-Math.cos(r)*.403+g,t.skin.body.rotation.y=-Math.cos(r)*.06,t.skin.leftArm.rotation.x=Math.sin(r+Math.PI)*.077+(h?.47:0),t.skin.leftArm.rotation.z=-Math.cos(r)*.015+.13-(h?0:.05),h||(t.skin.leftArm.position.z=Math.cos(r)*.3,t.skin.leftArm.position.x=5-Math.cos(r)*.05)}}}class ut extends v{animate(e){const t=this.progress*18;e.skin.rightArm.rotation.x=-.4537860552*2+2*Math.sin(t+Math.PI)*.3;const n=.01*Math.PI+.06;e.skin.rightArm.rotation.z=-Math.cos(t)*.403+n,e.skin.body.rotation.y=-Math.cos(t)*.06,e.skin.leftArm.rotation.x=Math.sin(t+Math.PI)*.077,e.skin.leftArm.rotation.z=-Math.cos(t)*.015+.13-.05,e.skin.leftArm.position.z=Math.cos(t)*.3,e.skin.leftArm.position.x=5-Math.cos(t)*.05}}const G=["head","body","rightArm","leftArm","rightLeg","leftLeg"],J=["innerLayer","outerLayer"],K={idle:new rt,walk:new dt,run:new mt,fly:new ht,wave:new lt,crouch:new D,hit:new ut};let a;function w(o){var d;const e=document.getElementById(o),t=document.getElementById(`${o}_upload`),n=document.getElementById(`${o}_unset`),s=(d=t==null?void 0:t.files)==null?void 0:d[0];return s?(n&&n.classList.remove("hidden"),e&&(e.value=`Local file: ${s.name}`,e.readOnly=!0),URL.createObjectURL(s)):(n&&!n.classList.contains("hidden")&&n.classList.add("hidden"),(e==null?void 0:e.value)||"")}function P(){const o=document.getElementById("skin_url"),e=w("skin_url");if(e==="")a.loadSkin(null),o==null||o.setCustomValidity("");else{const t=document.getElementById("skin_model"),n=document.getElementById("ears_source");a.loadSkin(e,{model:t==null?void 0:t.value,ears:(n==null?void 0:n.value)==="current_skin"}).then(()=>o==null?void 0:o.setCustomValidity("")).catch(s=>{o==null||o.setCustomValidity("Image can't be loaded."),console.error(s)})}}function H(){const o=document.getElementById("cape_url"),e=w("cape_url");if(e==="")a.loadCape(null),o==null||o.setCustomValidity("");else{const t=document.querySelector('input[type="radio"][name="back_equipment"]:checked');a.loadCape(e,{backEquipment:t==null?void 0:t.value}).then(()=>o==null?void 0:o.setCustomValidity("")).catch(n=>{o==null||o.setCustomValidity("Image can't be loaded."),console.error(n)})}}function x(o=!1){const e=document.getElementById("ears_source"),t=e==null?void 0:e.value;let n=!0;if(t==="none")a.loadEars(null);else if(t==="current_skin")o||P();else{n=!1;const d=document.querySelectorAll("#default_ears option[data-texture-type]");for(const g of d)g.disabled=g.dataset.textureType!==t;const r=document.getElementById("ears_url"),h=w("ears_url");h===""?(a.loadEars(null),r==null||r.setCustomValidity("")):a.loadEars(h,{textureType:t}).then(()=>r==null?void 0:r.setCustomValidity("")).catch(g=>{r==null||r.setCustomValidity("Image can't be loaded."),console.error(g)})}const s=document.getElementById("ears_texture_input");n?s&&!s.classList.contains("hidden")&&s.classList.add("hidden"):s&&s.classList.remove("hidden")}function z(){const o=document.getElementById("panorama_url"),e=w("panorama_url");e===""?(a.background=null,o==null||o.setCustomValidity("")):a.loadPanorama(e).then(()=>o==null?void 0:o.setCustomValidity("")).catch(t=>{o==null||o.setCustomValidity("Image can't be loaded."),console.error(t)})}function T(){var t,n,s,d;const o=(t=document.getElementById("background_type"))==null?void 0:t.value,e=((n=document.querySelector(".control-section h1"))==null?void 0:n.textContent)==="Panorama"?(s=document.querySelector(".control-section h1"))==null?void 0:s.parentElement:null;if(o==="color"){const r=(d=document.getElementById("background_color"))==null?void 0:d.value;a.background=r,e&&(e.style.display="none")}else e&&(e.style.display="block"),z()}function Q(){var e;const o=(e=document.getElementById("nametag_text"))==null?void 0:e.value;o===""?a.nameTag=null:a.nameTag=o}function gt(){const o=document.getElementById("canvas_width"),e=document.getElementById("canvas_height"),t=document.getElementById("fov"),n=document.getElementById("zoom"),s=document.getElementById("global_light"),d=document.getElementById("camera_light"),r=document.getElementById("animation_pause_resume"),h=document.getElementById("auto_rotate"),g=document.getElementById("auto_rotate_speed"),I=document.getElementById("control_rotate"),b=document.getElementById("control_zoom"),E=document.getElementById("control_pan"),k=document.getElementById("animation_speed"),l=document.getElementById("hit_speed"),y=document.getElementById("hit_speed_label"),f=document.getElementById("animation_crouch"),A=document.getElementById("add_hitting_animation");o==null||o.addEventListener("change",i=>{const c=i.target;a.width=Number(c.value)}),e==null||e.addEventListener("change",i=>{const c=i.target;a.height=Number(c.value)}),t==null||t.addEventListener("change",i=>{const c=i.target;a.fov=Number(c.value)}),n==null||n.addEventListener("change",i=>{const c=i.target;a.zoom=Number(c.value)}),s==null||s.addEventListener("change",i=>{const c=i.target;a.globalLight.intensity=Number(c.value)}),d==null||d.addEventListener("change",i=>{const c=i.target;a.cameraLight.intensity=Number(c.value)}),r==null||r.addEventListener("click",()=>{a.animation&&(a.animation.paused=!a.animation.paused)}),h==null||h.addEventListener("change",i=>{const c=i.target;a.autoRotate=c.checked}),g==null||g.addEventListener("change",i=>{const c=i.target;a.autoRotateSpeed=Number(c.value)});const _=document.querySelectorAll('input[type="radio"][name="animation"]');for(const i of _)i.addEventListener("change",c=>{const m=c.target,M=document.getElementById("crouch_setting");M&&(M.style.display=f!=null&&f.checked?"block":"none"),m.value===""?a.animation=null:(a.animation=K[m.value],a.animation&&k&&(a.animation.speed=Number(k.value)))});f==null||f.addEventListener("change",()=>{const i=document.querySelectorAll('input[type="checkbox"][name="crouch_setting_item"]');for(const c of i)c.checked=!1;l&&(l.value=""),y&&(y.style.display="none")});const tt={runOnce:i=>{a.animation&&(a.animation.runOnce=i)},showProgress:i=>{a.animation&&(a.animation.showProgress=i)},addHitAnimation:i=>{if(y&&(y.style.display=i?"block":"none"),i&&a.animation){const c=l==null?void 0:l.value;c===""?a.animation.addHitAnimation():a.animation.addHitAnimation(c)}}},S=()=>{a.animation=new D,a.animation&&k&&(a.animation.speed=Number(k.value));const i=document.querySelectorAll('input[type="checkbox"][name="crouch_setting_item"]');for(const c of i){const m=tt[c.value];m&&m(c.checked)}},et=document.querySelectorAll('input[type="checkbox"][name="crouch_setting_item"]');for(const i of et)i.addEventListener("change",()=>{S()});l==null||l.addEventListener("change",()=>{S()}),k==null||k.addEventListener("change",i=>{const c=i.target;a.animation&&(a.animation.speed=Number(c.value)),f!=null&&f.checked&&(A!=null&&A.checked)&&(l==null?void 0:l.value)===""&&S()}),I==null||I.addEventListener("change",i=>{const c=i.target;a.controls.enableRotate=c.checked}),b==null||b.addEventListener("change",i=>{const c=i.target;a.controls.enableZoom=c.checked}),E==null||E.addEventListener("change",i=>{const c=i.target;a.controls.enablePan=c.checked});for(const i of G)for(const c of J){const m=document.querySelector(`#layers_table input[type="checkbox"][data-part="${i}"][data-layer="${c}"]`);m==null||m.addEventListener("change",M=>{const B=M.target;a.playerObject.skin[i][c].visible=B.checked})}const L=(i,c)=>{const m=document.getElementById(i),M=document.getElementById(`${i}_upload`),B=document.getElementById(`${i}_unset`),X=()=>{m&&(m.readOnly=!1,m.value=""),M&&(M.value=M.defaultValue),c()};M==null||M.addEventListener("change",()=>c()),m==null||m.addEventListener("keydown",ot=>{ot.key==="Backspace"&&(m!=null&&m.readOnly)&&X()}),B==null||B.addEventListener("click",()=>X())};L("skin_url",P),L("cape_url",H),L("ears_url",x),L("panorama_url",z);const N=document.getElementById("skin_url"),R=document.getElementById("skin_model"),q=document.getElementById("cape_url"),V=document.getElementById("ears_source"),O=document.getElementById("ears_url"),j=document.getElementById("panorama_url");N==null||N.addEventListener("change",P),R==null||R.addEventListener("change",P),q==null||q.addEventListener("change",H),V==null||V.addEventListener("change",()=>x()),O==null||O.addEventListener("change",()=>x()),j==null||j.addEventListener("change",z);const nt=document.querySelectorAll('input[type="radio"][name="back_equipment"]');for(const i of nt)i.addEventListener("change",c=>{const m=c.target;a.playerObject.backEquipment===null||(a.playerObject.backEquipment=m.value)});const $=document.getElementById("reset_all");$==null||$.addEventListener("click",()=>{a.dispose(),U()});const W=document.getElementById("nametag_text");W==null||W.addEventListener("change",Q);const p=document.getElementById("background_type"),Z=document.getElementById("background_color");p==null||p.addEventListener("change",T),Z==null||Z.addEventListener("change",T),p&&(p.value="panorama"),T()}function U(){const o=document.getElementById("skin_container");if(!o)throw new Error("Canvas element not found");a=new st({canvas:o});const e=document.getElementById("canvas_width"),t=document.getElementById("canvas_height"),n=document.getElementById("fov"),s=document.getElementById("zoom"),d=document.getElementById("global_light"),r=document.getElementById("camera_light"),h=document.getElementById("auto_rotate"),g=document.getElementById("auto_rotate_speed"),I=document.getElementById("control_rotate"),b=document.getElementById("control_zoom"),E=document.getElementById("control_pan"),k=document.getElementById("animation_speed");a.width=Number(e==null?void 0:e.value),a.height=Number(t==null?void 0:t.value),a.fov=Number(n==null?void 0:n.value),a.zoom=Number(s==null?void 0:s.value),a.globalLight.intensity=Number(d==null?void 0:d.value),a.cameraLight.intensity=Number(r==null?void 0:r.value),a.autoRotate=(h==null?void 0:h.checked)??!1,a.autoRotateSpeed=Number(g==null?void 0:g.value);const l=document.querySelector('input[type="radio"][name="animation"]:checked'),y=l==null?void 0:l.value;y&&(a.animation=K[y],a.animation&&k&&(a.animation.speed=Number(k.value))),a.controls.enableRotate=(I==null?void 0:I.checked)??!1,a.controls.enableZoom=(b==null?void 0:b.checked)??!1,a.controls.enablePan=(E==null?void 0:E.checked)??!1;for(const f of G)for(const A of J){const _=document.querySelector(`#layers_table input[type="checkbox"][data-part="${f}"][data-layer="${A}"]`);a.playerObject.skin[f][A].visible=(_==null?void 0:_.checked)??!1}P(),H(),x(!0),z(),Q()}U();gt();const C=new ct;C.dom.style.left="";C.dom.style.right="0";document.body.appendChild(C.dom);function Y(){C.update(),requestAnimationFrame(Y)}requestAnimationFrame(Y);
